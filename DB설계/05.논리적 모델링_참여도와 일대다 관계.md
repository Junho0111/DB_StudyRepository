# 데이터베이스 설계 (논리적 모델링 - 참여도와 1:N)

### 1. 관계의 참여도 (Optionality)

참여도는 두 엔티티 간의 관계에서 **"상대방 엔티티의 데이터가 반드시 있어야 하는가?"**를 결정하며, 이는 데이터 무결성의 기초임.

| 구분 | 설명 | 표기법 (ERD) | 데이터베이스 처리 |
| --- | --- | --- | --- |
| **필수 참여 (Mandatory)** | 데이터가 반드시 존재해야 함 | 실선 또는 '1' (작대기) | **NOT NULL** 제약 조건 적용 |
| **선택 참여 (Optional)** | 데이터가 없어도 됨 (0개 가능) | 점선 또는 'O' (동그라미) | **NULL 허용** |

* **예시**: "모든 주문은 반드시 회원이 있어야 하지만, 회원은 주문을 한 번도 안 했을 수 있다."
* 주문 쪽에서 회원 방향은 **필수**, 회원 쪽에서 주문 방향은 **선택**.

<br>

### 2. 일대다(1:N) 관계의 논리적 매핑

많이 강조되는 실무 패턴. 1:N 관계를 테이블로 옮길 때의 절대 원칙.

* **원칙**: **'다(N)' 쪽에 '일(1)'의 기본 키(PK)를 외래 키(FK)로 추가**함.
* **이유**: '일(1)' 쪽에 '다(N)'의 정보를 넣으려면 컬럼을 무한정 늘려야 하지만, '다(N)' 쪽에 넣으면 행(Row)만 추가하면 되기 때문임.

<br>

### 3. 부모 테이블과 자식 테이블

관계의 방향성에 따른 명칭.

* **부모 테이블 (Parent)**: PK를 제공하는 '일(1)' 쪽 테이블 (예: 회원)
* **자식 테이블 (Child)**: FK를 들고 있는 '다(N)' 쪽 테이블 (예: 주문)
* **영향**: 부모 데이터가 삭제될 때 자식 데이터를 어떻게 할지(CASCADE 등) 결정하는 기준이됨.

<br>

### 4. 일대일(1:1) 관계의 매핑 전략

1:1 관계는 어느 쪽에 FK를 두어도 상관없으나, 실무에선 **"주 테이블(접근이 더 잦은 쪽)"**에 두는 것을 권장.

* **방법 1**: 주 테이블에 외래 키를 둠 (가장 일반적, 객체지향적)
* **방법 2**: 대상 테이블에 외래 키를 둠 (테이블 구조 변경에 유연)

<br>

### 5. 시나리오별 사용 예시 (Scenario & Example)

* **참여도(Optionality)에 따른 DDL 설계**: "주문과 회원의 관계 설정"
```sql
-- [부모 테이블] 회원: 주문이 없어도 존재할 수 있음 (Optional)
CREATE TABLE member (
    member_id BIGINT PRIMARY KEY,
    name VARCHAR(50) NOT NULL
);

-- [자식 테이블] 주문: 반드시 회원이 있어야 생성 가능함 (Mandatory)
CREATE TABLE orders (
    order_id BIGINT PRIMARY KEY,
    order_date DATETIME NOT NULL,
    member_id BIGINT NOT NULL, -- 필수 참여이므로 NOT NULL 제약 추가
    CONSTRAINT fk_orders_member FOREIGN KEY (member_id) REFERENCES member(member_id)
);

```
<br>

* **1:N 관계의 데이터 적재**: "부서와 직원 시나리오"
```sql
-- 부서(1) : 직원(N) 관계
-- 부서 테이블(1)에는 직원 정보를 넣지 않음
-- 직원 테이블(N)에 부서 PK를 외래 키로 관리함

INSERT INTO department (dept_id, dept_name) VALUES (1, '개발팀');

-- 개발팀(ID: 1)에 소속된 여러 명의 직원을 행(Row)으로 추가
INSERT INTO employee (emp_id, name, dept_id) VALUES (101, '김개발', 1);
INSERT INTO employee (emp_id, name, dept_id) VALUES (102, '이코드', 1);

```
<br>

* **1:1 관계의 주 테이블 설정**: "회원과 신체검사 정보"
```sql
-- 회원(주 테이블)과 신체정보(대상 테이블)가 1:1인 경우
-- 회원을 조회할 때 신체정보가 필요한 경우가 많다면 member에 FK를 두는 것이 성능상 유리함
CREATE TABLE member (
    member_id BIGINT PRIMARY KEY,
    username VARCHAR(50),
    health_info_id BIGINT UNIQUE -- 1:1 관계를 위해 UNIQUE 제약 필수
);

```
<br>

* **삭제 정책(CASCADE) 설정**: "부모 데이터 삭제 시 자식 데이터 처리"
```sql
-- 회원이 탈퇴할 때 해당 회원의 주문 내역을 함께 삭제하도록 설정
ALTER TABLE orders 
ADD CONSTRAINT fk_member_cascade 
FOREIGN KEY (member_id) REFERENCES member(member_id) 
ON DELETE CASCADE;

```
<br>

### 6. 요약 & 실무 포인트

* **NULL 허용 여부의 신중함**: 선택 참여(`Optional`)로 설정하여 FK에 NULL을 허용하면 쿼리 작성이 복잡해질 수 있음. 비즈니스 로직상 반드시 필요한 경우가 아니라면 가급적 필수 참여 설계를 고민해보아야함.
* **1:N은 데이터베이스의 기본**: 실무 데이터베이스의 80~90%는 1:N 관계임. 이 매핑 규칙만 정확히 이해해도 설계의 절반은 완성임.
* **ERD와 물리 테이블의 간격**: ERD의 새발 모양(Crows Foot)이 가리키는 쪽이 '다(N)'이며, 그곳에 외래 키 컬럼이 생겨야 함을 머릿속으로 즉시 연결할 수 있어야함.