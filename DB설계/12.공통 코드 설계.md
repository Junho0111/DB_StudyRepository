# 공통 코드 설계 (Common Code Design)

### 1. 공통 코드란?

시스템 전반에서 공통적으로 사용되는 상태, 유형, 등급 등의 데이터를 의미.

* **예시**: 주문 상태(대기, 배송중, 완료), 결제 수단(신용카드, 계좌이체), 회원 등급(일반, VIP) 등.
* **필요성**: 각 테이블에 "배송중", "배송완료"를 직접 텍스트로 저장하면 오타가 발생할 수 있고, 명칭 변경 시 모든 테이블을 수정해야 하는 문제를 방지하기 위함.

<br>

### 2. 공통 코드 테이블 구조 (Group Code & Detail Code)

강의에서는 코드 관리를 위해 보통 **그룹 코드**와 **상세 코드**의 2단계 구조를 권장함.

| 테이블 | 설명 | 주요 컬럼 |
| --- | --- | --- |
| **코드 그룹 (Code Group)** | 코드의 대분류를 정의 | 그룹코드(PK), 그룹명, 사용여부 |
| **코드 상세 (Code Detail)** | 그룹에 속한 실제 코드 값 | 그룹코드(FK), 상세코드(PK), 코드명, 순서 |

<br>

### 3. 공통 코드 설계의 장점

* **데이터 무결성**: 정의된 코드값만 입력되도록 강제할 수 있음.
* **유지보수 용이**: 코드의 명칭이 바뀌어도(예: '배송중' -> '배송중(상품)') 코드 테이블의 데이터만 수정하면됨.
* **애플리케이션 연동**: 서버단에서 Enum이나 상수값과 매핑하여 관리하기 편리.

<br>

### 4. 실무 설계 시 주의사항

물리적 설계의 디테일.

1. **정렬 순서(Sort Order)**: 화면 리스트에 출력될 순서를 결정하는 컬럼이 반드시 필요함.
2. **사용 여부(Use Y/N)**: 코드를 삭제하는 대신 사용 여부를 'N'으로 변경하여 기존 데이터의 이력을 보존함.
3. **다국어 지원**: 글로벌 서비스라면 코드명 테이블을 분리하여 언어별 명칭을 저장하는 구조로 확장함.

<br>

### 5. 시나리오별 사용 예시 (Scenario & Example)

* **코드 그룹과 상세 코드 설계**: "주문 상태와 결제 수단을 체계적으로 관리"
```sql
-- 1. 코드 그룹 생성 (주문상태, 결제수단)
INSERT INTO code_group (group_code, group_name) VALUES ('ORDER_STAT', '주문상태');
INSERT INTO code_group (group_code, group_name) VALUES ('PAY_METHOD', '결제수단');

-- 2. 상세 코드 생성 (그룹코드와 연결하여 실제 데이터 정의)
INSERT INTO code_detail (group_code, code, code_name, sort_order) 
VALUES ('ORDER_STAT', 'WAIT', '결제대기', 1),
       ('ORDER_STAT', 'PROG', '배송중', 2),
       ('ORDER_STAT', 'COMP', '배송완료', 3);

```
<br>

* **데이터 일관성 유지**: "주문 테이블에서 텍스트 대신 코드값 참조"
```sql
-- [나쁜 예시] status = '배송중' (오타 발생 시 데이터가 꼬임)
-- [좋은 예시] status_code = 'PROG' (공통 코드 테이블에 정의된 값만 사용)
UPDATE orders SET status_code = 'PROG' WHERE order_id = 101;

```
<br>

* **정렬 순서(Sort Order) 활용**: "화면의 콤보박스나 리스트에 출력되는 순서 제어"
```sql
-- 화면 기획에 맞춰 '배송중'을 가장 먼저 보여줘야 할 때 sort_order만 수정함
-- SQL 조회 시 반드시 ORDER BY sort_order 적용
SELECT code, code_name 
FROM code_detail 
WHERE group_code = 'ORDER_STAT' 
ORDER BY sort_order ASC;

```
<br>

* **사용 여부(Use Y/N)를 통한 이력 보존**: "더 이상 사용하지 않는 결제 수단 처리"
```sql
-- 과거 주문 내역에 해당 코드가 남아있으므로 DELETE 대신 상태만 변경
UPDATE code_detail SET use_yn = 'N' WHERE code = 'OLD_PAY_TYPE';

```
<br>

### 6. 실무 포인트

* **Hard Coding 금지**: "01", "02" 같은 코드값을 소스 코드에 직접 하드코딩하지 말고, DB에서 관리하거나 서버의 Enum으로 관리해야함.
* **성능 고려**: 공통 코드는 조회 빈도가 매우 높기 때문에 서버 메모리에 **캐싱(Caching)**하여 DB 부하를 줄이는 전략을 함께 사용해야함.
* **도메인 성격 구분**: 너무 비즈니스 로직에 깊게 관여하는 코드는 공통 코드보다는 별도의 마스터 테이블(예: 상품 카테고리)로 관리하는 것이 나을 수 있음.