# 데이터베이스 설계 (정규화 - Normalization)

### 1. 정규화의 개념과 목적

정규화는 잘못 설계된 관계형 데이터베이스 구조를 수정하여 **데이터 중복을 최소화**하고 **이상 현상(Anomaly)**을 제거하는 과정임.

* **목적**: 데이터의 일관성 유지, 저장 공간 최소화, 데이터 구조의 유연성 확보.
* **핵심 원칙**: "한 곳에는 하나의 의미만 담는다." (One Fact in One Place)

<br>

### 2. 정규화를 하지 않았을 때의 문제 (이상 현상)

1. **삽입 이상**: 데이터를 저장할 때 원치 않는 정보까지 함께 입력해야 하거나, 특정 정보가 없으면 입력이 불가능한 현상.
2. **갱신 이상**: 중복된 데이터 중 일부만 수정되어 데이터 간 불일치가 발생하는 현상.
3. **삭제 이상**: 특정 정보를 삭제할 때 유지되어야 할 다른 정보까지 연쇄적으로 삭제되는 현상.

<br>

### 3. 단계별 정규화 (제1, 2, 3 정규화)

| 단계 | 규칙 (Rule) | 주요 내용 |
| --- | --- | --- |
| **제1정규형 (1NF)** | **원자 값** | 모든 컬럼의 값은 하나(원자 값)여야 함. (한 칸에 여러 값 금지) |
| **제2정규형 (2NF)** | **부분 함수 종속 제거** | 기본 키가 복합키일 때, 일부 키에만 종속되는 컬럼을 분리함. |
| **제3정규형 (3NF)** | **이행 함수 종속 제거** | PK가 아닌 컬럼 간의 종속성을 제거함. (A→B, B→C 관계에서 C를 분리) |

<br>

### 4. 정규화 실습 예시

* **1NF 위반**: '취미' 컬럼에 `축구, 농구`가 같이 들어있는 경우 -> 행을 분리하거나 테이블을 나눔.
* **2NF 위반**: `[학번, 과목코드]`가 PK인데, `학생이름`이 `학번`에만 종속된 경우 -> `학생` 테이블로 분리.
* **3NF 위반**: `사원번호(PK)` -> `부서번호` -> `부서명` 관계일 때, `부서명`은 `사원번호`가 아닌 `부서번호`에 종속됨 -> `부서` 테이블로 분리.

<br>

### 5. 시나리오별 사용 예시 (Scenario & Example)

* **제1정규형(1NF) 적용**: "한 컬럼에 여러 값이 들어간 주문 테이블 수정"
```sql
-- [수정 전] 주문상품 컬럼에 '사과, 배, 포도'가 쉼표로 구분되어 들어감 (원자성 위반)
-- [수정 후] 각 상품을 별도의 행으로 분리하거나 주문상세(order_item) 테이블로 독립시킴
SELECT order_id, product_name FROM order_item;
-- 101, 사과
-- 101, 배

```
<br>

* **제2정규형(2NF) 적용**: "복합키 사용 시 부분 종속성 제거"
```sql
-- [상황] PK가 {학생번호, 과목코드}인데 '학생이름' 컬럼이 포함된 경우
-- 학생이름은 {학생번호, 과목코드} 전체가 아닌 '학생번호'에만 종속됨 (부분 함수 종속)
-- [해결] {학생번호, 학생이름}을 가지는 '학생' 테이블로 분리함
CREATE TABLE student (
    student_id INT PRIMARY KEY,
    student_name VARCHAR(50)
);

```
<br>

* **제3정규형(3NF) 적용**: "일반 컬럼 간의 종속 관계(이행 종속) 해결"
```sql
-- [상황] 사원번호(PK) -> 부서코드 -> 부서명 (사원번호를 알면 부서코드를 알고, 부서코드를 알면 부서명을 암)
-- 부서명은 PK가 아닌 부서코드에 종속되어 있음 (이행 함수 종속)
-- [해결] {부서코드, 부서명}을 '부서' 테이블로 분리하여 중복을 제거함
CREATE TABLE department (
    dept_code VARCHAR(10) PRIMARY KEY,
    dept_name VARCHAR(50)
);

```
<br>

* **이상 현상(Anomaly)의 실제**: "정규화되지 않은 테이블의 위험성"
```sql
-- 삭제 이상: 마지막 학생이 자퇴하여 수강 정보를 지웠더니, 해당 과목의 교수님 정보까지 사라짐
-- 갱신 이상: 부서명이 '개발팀'에서 '기술팀'으로 바뀌었는데 일부 사원 레코드만 수정되어 데이터 불일치 발생

```
<br>

### 6. 요약 & 실무 포인트

* **실무는 3정규형까지**: 이론적으로는 BCNF, 4차, 5차 정규화도 있지만, 실무에서는 **제3정규형(3NF)**까지만 제대로 해도 거의 모든 문제가 해결됨.
* **성능과 정규화 (반정규화)**: 정규화를 하면 테이블이 쪼개져서 조인(Join)이 많아짐. 조회 성능이 너무 떨어질 경우 전략적으로 다시 합치는 **'반정규화(Denormalization)'**를 고민하기도 하지만, **"무조건 정규화가 우선"**임.
* **유지보수의 핵심**: 정규화가 잘 된 DB는 데이터 수정 시 단 한 곳만 고치면 되기 때문에 버그가 획기적으로 줄어듬.