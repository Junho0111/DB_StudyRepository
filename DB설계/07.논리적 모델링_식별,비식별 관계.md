# 데이터베이스 설계 (식별 관계 vs 비식별 관계)

### 1. 식별 관계 (Identifying Relationship)

부모 테이블의 기본 키(PK)를 가져와서 자식 테이블의 **기본 키(PK) 겸 외래 키(FK)**로 사용하는 관계임.

* **특징**: 자식 테이블의 생존이 부모 테이블에 완전히 종속됨. 부모 없이는 자식의 정체성(PK)이 성립되지 않음.
* **ERD 표기**: 주로 **실선**으로 표시.
* **예시**: `부모(ID)` ↔ `자식(부모ID, 자식순번)` 형태.

<br>

### 2. 비식별 관계 (Non-Identifying Relationship)

부모 테이블의 기본 키를 가져와서 자식 테이블의 **일반 외래 키(FK)**로만 사용하는 관계.

* **특징**: 자식 테이블은 부모와 별개로 자신만의 독립적인 기본 키(보통 대리 키)를 가짐. 부모가 없어도 자식은 독립적인 존재로 정의될 수 있음.
* **ERD 표기**: 주로 **점선**으로 표시.
* **예시**: `부모(ID)` ↔ `자식(자식ID, 부모ID_FK)` 형태.

<br>

### 3. 두 관계의 장단점 비교

| 구분 | 식별 관계 (Identifying) | 비식별 관계 (Non-Identifying) |
| --- | --- | --- |
| **PK 구조** | 부모 PK를 포함하여 복합 키가 됨. | 자기만의 단일 PK를 가짐. |
| **장점** | 데이터 무결성이 강력함. 조인 없이 상위 ID 확인 가능. | 구조가 단순함. PK 변경에 유연함. |
| **단점** | 손자, 증손자로 갈수록 PK 컬럼이 계속 늘어남. | 부모 데이터 확인을 위해 조인이 더 자주 필요할 수 있음. |

<br>

### 4. 시나리오별 사용 예시 (Scenario & Example)

* **식별 관계 구현**: "주문과 주문상세 (강한 종속 관계)"
```sql
-- 부모(order)의 PK가 자식(order_item)의 PK 구성 요소가 됨
CREATE TABLE orders (
    order_id BIGINT PRIMARY KEY,
    order_date DATETIME
);

CREATE TABLE order_item (
    order_id BIGINT,      -- 부모의 PK를 가져옴
    line_no INT,          -- 자식 내부의 순번
    product_name VARCHAR(50),
    PRIMARY KEY (order_id, line_no), -- 복합키(PK)이자 FK
    CONSTRAINT fk_oi_order FOREIGN KEY (order_id) REFERENCES orders(order_id)
);

```
<br>

* **비식별 관계 구현**: "부서와 직원 (독립적인 존재)"
```sql
-- 부서가 사라져도 직원은 다른 부서로 옮기거나 독립적으로 존재할 수 있음
CREATE TABLE department (
    dept_id BIGINT PRIMARY KEY,
    dept_name VARCHAR(50)
);

CREATE TABLE employee (
    emp_id BIGINT PRIMARY KEY, -- 자신만의 독립적인 PK(대리 키)
    name VARCHAR(50),
    dept_id BIGINT,            -- 일반 외래 키(FK)로만 사용
    CONSTRAINT fk_emp_dept FOREIGN KEY (dept_id) REFERENCES department(dept_id)
);

```
<br>

* **식별 관계의 전계(Propagation) 문제**: "손자 테이블까지 PK가 전이되는 상황"
```sql
-- 식별 관계를 남용하면 증손자 테이블은 [증조부ID, 조부ID, 부모ID, 내ID]를 
-- 모두 PK로 들고 있어야 함. 쿼리의 WHERE 절과 JOIN 조건이 매우 길어짐.
SELECT * FROM great_grandchild
WHERE great_grand_id = 1 AND grand_id = 1 AND parent_id = 1 AND child_id = 1;

```
<br>

* **비식별 관계와 대리 키의 유연성**: "부모 데이터 변경 시"
```sql
-- 직원의 부서가 바뀌어도(UPDATE employee SET dept_id = 2) 
-- 직원의 고유 식별자(emp_id)는 변하지 않으므로 연관된 다른 테이블에 영향이 없음.

```
<br>

### 5. 요약 & 실무 포인트 (매우 중요)

* **"비식별 관계를 기본으로 사용하라"**: 실무에서는 거의 모든 관계를 비식별 관계로 설계하는 것이 유리
* 이유 1: 식별 관계는 부모-자식-손자로 내려갈수록 PK 컬럼이 눈덩이처럼 불어나 SQL이 복잡해짐.
* 이유 2: 비식별 관계는 비즈니스 변화(부모가 바뀌는 경우 등)에 훨씬 유연하게 대처할 수 있음.

* **대리 키와의 조합**: 비식별 관계를 사용하면서 자식 테이블에 `id` 같은 대리 키(Surrogate Key)를 PK로 설정하면, JPA나 MyBatis 같은 프레임워크와 연동할 때 훨씬 깔끔한 코드가 나옴.
* **예외적인 식별 관계**: 아주 밀접하게 연결되어 절대 분리될 수 없는 관계(예: 주문과 주문상세)에서만 선택적으로 고려함.
