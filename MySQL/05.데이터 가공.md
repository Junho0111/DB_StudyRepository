# SQL - 데이터 가공

### 산술 연산 (Arithmetic Operations)

데이터베이스에 저장된 숫자 데이터를 조회할 때 사칙연산을 사용하여 새로운 값을 계산할 수 있음.

| 기능 | 연산자 | 사용 예시 (Example) |
| --- | --- | --- |
| **더하기** | `+` | `SELECT price + 1000 FROM products;` |
| **빼기** | `-` | `SELECT stock_quantity - 5 FROM products;` |
| **곱하기** | `*` | `SELECT price * stock_quantity AS total_price FROM products;` |
| **나누기** | `/` | `SELECT price / 2 FROM products;` |

<br>

### 문자열 함수 (String Functions)

텍스트 데이터를 결합하거나 추출하여 보기 좋게 가공할 때 사용.

| 함수명 | 설명 | 사용 예시 (Example) |
| --- | --- | --- |
| **CONCAT** | 여러 문자열을 하나로 연결 | `SELECT CONCAT(name, ' (', price, '원)') FROM products;` |
| **SUBSTRING** | 문자열의 일부분만 추출 | `SELECT SUBSTRING(address, 1, 2) FROM customers; (1번째부터 2글자)` |
| **CHAR_LENGTH** | 문자열의 길이를 계산 | `SELECT CHAR_LENGTH(name) FROM products;` |
| **UPPER / LOWER** | 대문자 / 소문자로 변환 | `SELECT UPPER(email) FROM customers;` |
| **SUBSTRING_INDEX** | 구분자를 기준으로 문자열 분리 | `SELECT SUBSTRING_INDEX(email, '@', 1); (이메일 아이디 추출)` |

<br>

### NULL 처리 함수 (Handling NULL)

데이터가 없는 `NULL` 상태를 안전하게 처리하기 위한 함수.

| 함수명 | 설명 | 사용 예시 (Example) |
| --- | --- | --- |
| **COALESCE** | 첫 번째로 NULL이 아닌 값을 반환 | `SELECT COALESCE(phone, '연락처 없음') FROM customers;` |
| **IFNULL** | 값이 NULL이면 지정된 값으로 대체 | `SELECT IFNULL(stock_quantity, 0) FROM products;` |

<br>

### 기타 유용한 함수 (Miscellaneous Functions)

| 분류 | 함수/표현식 | 설명 | 사용 예시 |
| --- | --- | --- | --- |
| **반올림** | `ROUND(값, 소수점)` | 숫자를 특정 위치에서 반올림 | `SELECT ROUND(price * 0.1, 0);` |
| **조건문** | `CASE WHEN` | 조건에 따라 다른 결과 출력 | `CASE WHEN price > 50000 THEN '고가' ELSE '저가' END` |
| **현재 시간** | `NOW()` | 현재 날짜와 시간을 반환 | `SELECT NOW();` |

<br>

### 시나리오별 사용 예시 (Scenario & Example)

* **산술 연산 및 별칭**: "상품 단가와 재고량을 곱해 총 재고 가액 계산"
```sql
-- 연산 결과를 total_value라는 별칭으로 정의하여 가독성 확보함
SELECT name, 
       price * stock_quantity AS total_value
FROM products;

```
<br>

* **문자열 가공 (CONCAT, SUBSTRING)**: "회원 목록 출력 시 주소 요약과 이메일 아이디만 추출"
```sql
-- 주소는 앞의 두 글자(시/도)만 따고, 이메일은 @ 앞부분만 분리하여 연결함
SELECT name,
       CONCAT('[', SUBSTRING(address, 1, 2), '] ', SUBSTRING_INDEX(email, '@', 1)) AS user_info
FROM customers;

```
<br>

* **NULL 처리와 산술 연산**: "할인 금액 계산 시 NULL인 데이터를 0으로 치환하여 계산"
```sql
-- discount_amount가 NULL이면 산술 결과가 NULL이 되므로 0으로 보정함
SELECT name,
       price - IFNULL(discount_amount, 0) AS final_price
FROM products;

```
<br>

* **조건부 데이터 가공 (CASE)**: "재고 수량에 따라 판매 가능 상태를 텍스트로 표시"
```sql
SELECT name,
       CASE 
           WHEN stock_quantity > 10 THEN '재고여유'
           WHEN stock_quantity > 0  THEN '품절임박'
           ELSE '품절'
       END AS stock_status
FROM products;

```
<br>

### 핵심 요약 및 활용 팁

#### **1. 별칭(Alias)의 필수 사용**

산술 연산이나 함수를 사용하면 컬럼명이 `price * stock_quantity`처럼 복잡해지므로. 반드시 `AS` 키워드를 사용하여 `AS 재고액`과 같이 의미 있는 이름을 붙여주는 것이 좋음.

<br>

#### **2. 데이터 가공의 위치**

데이터 가공은 주로 `SELECT` 절에서 이루어지지만, `WHERE` 절이나 `ORDER BY` 절에서도 함수를 사용할 수 있음.

* 예: `WHERE CHAR_LENGTH(name) >= 5` (이름이 5글자 이상인 상품만 조회)

<br>

#### **3. 문자열 결합 주의사항**

`CONCAT` 함수 사용 시 인자 중 하나라도 `NULL`이면 결과 전체가 `NULL`이 되어버림. 이를 방지하기 위해 `COALESCE`나 `IFNULL`을 적절히 혼합하여 사용하는 것이 안전.

---