# SQL - 조인 2 (외부 조인과 기타 조인)

### 외부 조인 (OUTER JOIN)

내부 조인(INNER JOIN)이 양쪽 테이블에 모두 데이터가 있는 경우만 조회한다면, 외부 조인은 한쪽 테이블에만 데이터가 있어도 결과에 포함. 매칭되는 데이터가 없는 반대쪽 컬럼은 `NULL`로 표시.

| 종류 | 설명 | 사용 예시 (Example) |
| --- | --- | --- |
| **LEFT JOIN** | 왼쪽 테이블의 모든 행을 유지하며 오른쪽을 결합 | `SELECT * FROM customers c LEFT JOIN orders o ON c.customer_id = o.customer_id;` |
| **RIGHT JOIN** | 오른쪽 테이블의 모든 행을 유지하며 왼쪽을 결합 | `SELECT * FROM orders o RIGHT JOIN customers c ON o.customer_id = c.customer_id;` |

* **실무 팁**: 대부분의 경우 `LEFT JOIN`만으로 모든 상황을 표현할 수 있으므로, 기준이 되는 테이블을 왼쪽에 두고 `LEFT JOIN`을 사용하는 것이 관례.

<br>

### 외부 조인의 활용: 데이터 누락 확인

외부 조인을 사용하면 '주문 이력이 없는 고객'이나 '한 번도 팔리지 않은 상품' 등 데이터 간의 공백을 찾을 수 있음.

* **예시 (주문 안 한 고객 찾기)**:

```sql
SELECT c.name
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
WHERE o.order_id IS NULL; -- 오른쪽(주문) 테이블의 PK가 NULL인 것만 필터링
```

<br>

### 기타 조인 (Self Join & Cross Join)

| 종류 | 설명 | 사용 예시 (Example) |
| --- | --- | --- |
| **셀프 조인 (Self Join)** | 하나의 테이블을 자기 자신과 조인 (계층 구조 시 사용) | `SELECT e1.name, e2.name AS 상사명 FROM employee e1 JOIN employee e2 ON e1.manager_id = e2.id;` |
| **교차 조인 (Cross Join)** | 두 테이블의 모든 행을 서로 곱함 (카테시안 곱) | `SELECT * FROM products CROSS JOIN colors; (모든 상품과 모든 색상의 조합)` |

<br>

### 조인 사용 시 주의사항 및 요약

#### **1. 기준 테이블 선정**

`LEFT JOIN`을 쓸 때는 **'데이터가 유실되면 안 되는 쪽'**을 반드시 `FROM` 절(왼쪽)에 써야 함. 예를 들어, 전체 고객 명단이 필요하다면 `customers`가 기준이 되어야함.

#### **2. 다중 조인 (Multiple Join)**

3개 이상의 테이블을 조인할 때는 순차적으로 조인이 일어남.

```sql
SELECT c.name, p.name, o.order_date
FROM orders o
JOIN customers c ON o.customer_id = c.customer_id
JOIN products p ON o.product_id = p.product_id;
```

#### **3. WHERE 절 vs ON 절의 차이 (OUTER JOIN 시)**

* `ON` 절: 조인을 수행하기 전 매칭 조건을 결정 (외부 조인에서 데이터 유지 여부 결정)
* `WHERE` 절: 조인이 끝난 결과 집합에서 필터링 수행